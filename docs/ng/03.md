## Angular中的模块机制

### module

在AngularJS中，有module的概念，但是它这个module，跟我们通常在AMD里面看到的module是完全不同的两种东西，大致可以相当于是一个namespace，或者package，表示的是一堆功能单元的集合。

一个比较正式的Angular应用，需要声明一个module，供初始化之用。比如说：

```JavaScript
var app = angular.module("test", []);
```

随后，可以在HTML中指定这个module：

```HTML
<div ng-app="test">
</div>
```

这样，就是以这个div为基准容器，实例化了刚才定义的module。

或者，也可以等价地这样：

```JavaScript
angular.element(document).ready(function() {
    angular.bootstrap(document.getElementById("someDiv"), ["test"]);
});
```

在这里，我们很清楚地看到，module的意义是用于标识在一个页面中可能包含的多个Angular应用。比如说，可以这样：

```HTML
<div ng-app="test">
</div>
<div ng-app="test">
</div>
```

在同一个页面中创建同一module的不同实例。两个应用互不干涉，在各自的容器中运行。

除此之外，我们可以看到，在module声明的时候，后面带一个数组，这个数组里面可以指定它所依赖的module。比如说：

```JavaScript
angular.module("moduleB", [])
    .service("GreetService", function() {
    return {
        greet: function() {
            return "Hello, world";
        };
    };
});

angular.module("moduleA", ["moduleB"])
    .controller("TestCtrl", ["$scope", "GreetService", function($scope, GreetService) {
    $scope.words = "";
    $scope.greet = function() {
        $scope.words = GreetService.greet();
    };
}]);
```

然后对应的HTML是：

```HTML
<div ng-app="moduleA">
    <div ng-controller="TestCtrl">
        <span ng-bind="words"></span>
        <button ng-click="greet()">Greet</button>
    </div>
</div>
```

好了，注意到这个例子里面，创建了两个module，在页面上只直接初始化了moduleA，但是从moduleA的依赖关系中，引用到了moduleB，所以，moduleA下面的TestCtrl，可以像引用同一个module下其他service那样，引用moduleB中定义的service。



那么，我们可以把module设计的初衷理解为：供不同的开发团队，或者不同的业务模块做归类约束用。考虑到在前端体系中，JavaScript是需要加载到浏览器才能使用的，module的机制至少应当包括异步加载机制，很可惜，没有。

没有模块加载机制，意味着什么呢？

看下面这个例子：

```JavaScript
angular.module("moduleA", [])
    .factory("A", function() {
        return "a";
    })
    .factory("B", function() {
        return "b";
    });

angular.module("moduleB", [])
    .factory("A", function() {
        return "A";
    })
    .factory("B", function() {
        return "B";
    });

angular.module("moduleC", ["moduleA", "moduleB"])
    .factory("C", ["A", "B", function(A, B) {
        return A + B;
    }])
    .controller("TestCtrl", ["$scope", "C", function($scope, C) {
        $scope.c = C;
    }]);
```

```HTML
<body ng-app="moduleC">
	<div ng-controller="TestCtrl">
		<span ng-bind="c"></span>
	</div>
</body>
```

我们在moduleA和moduleB中，分别定义了两个A跟B，然后，在moduleC中依赖这两个module，这时候，